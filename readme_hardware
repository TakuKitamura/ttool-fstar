Installation for Linux and MacOSX: 
==================================
System preconditions : 
1) You have to obtain TTool from the Telecom site. This is usually already done
as this readme is includes in TTool.

2) You have to obtain the Prog arborescence from the svn containing MutekH and a SoClib platform

3) Your system has to feature a gcc compiler and a gdb

- Linux : gcc 4.7. was tested with success but is not he most recent
- MacOSX : there are some difficulties with MacOSX, we recommend the homebrew gcc-4.8 compiler

4) The crosscompiler will serve to compile your application (the task and main file produced by TTool)
   for the desired architecture.
   To generate your crosscompilers, you have to execute ./crossgen.mk in
  the Prog/mutekh directory. Usually type 
  ./crossgen.mk all 
  the first time 
  Currently only PowerPC is available, but it is relatively easy to add others as MutekH
  allows heterogeneous processors - the topcell is written in a way
  that it works for the following :  

  ppc405
  niosII
  mips32
  arm.h
  sparcv8.h
  lm32.h

5) You have to have a valid SystemC compiler to compile the SoCLib platform

- Linux : systemc-2.2.0 was tested
- MacOSX : systemc-2.3.1 from Accellera was tested with success; here is the link : accellera.org/downloads/standards/systemc

SystemCASS also works, libraries for Linux are contained in the distribution

-------------------------------------------------------------------------------
Additions to the TTool arborescence:
====================================
in the executablecode directory three new sub directories were added for MPSoC execution: 

- generated_code_soclib: generated task code for the blocks and main code spawning the POSIX threads
- src_soclib : the runtime for MPSoC platforms (using mwmr channels)
- generated_topcell: topcell and bits of mapping information to generate the ldscript

--------------------------------------------------------------------
TTool will copy code from these directories into the Prog arborescence as follows:

generated_code_soclib :  *.c and *h to Prog/mutekh/examples/avatar
		      src_soclib to Prog/mutekh/libavatar

generated_topcell :
		  top.cc to  ~/Prog/soclib/soclib/platform/topcells/caba-vgmn-mutekh_kernel_tutorial/top.cc
		 deployinfo.h and deployinfo_map.h to ~/Prog/mutekh/arc/soclib
                 they are used by ldscrot.cpp, a preprocessor generating the ldscript

-------------------------------------------------------------
Using TTool/AVATAR with SoCLib
-------------------------------------------------------------
Code Generation from Deployment Diagrams

In the src directory, ddtranslatorSoclib was added, which analyzed the deployment diagram
it contains subdirectories toSoclib and toTopCell generating task/main code and topcell/information for the 
ldscript and main, respectively
Other files from TTool had to be slightly adapted, not listed here

Makefile :
==========

To compile for the soclib (simulated) MPSoC platform, you have
to add a new target to executablecode/Makefile.forsoclib

updategeneratedcodesoclib:
	cp ~/TURTLE/executablecode/generated_src_soclib/*.c ~/Prog/mutekh/exampl
es/avatar 
	cp ~/TURTLE/executablecode/Makefile.soclib ~/Prog/mutekh/examples/avatar
/Makefile

You also have to update the MPSoC version of the runtime 

updateruntimesoclib:
	cp ~/TURTLE/executablecode/src_soclib/*.c ~/Prog/mutekh/libavatar/
	cp ~/TURTLE/executablecode/src_soclib/*.h ~/Prog/mutekh/libavatar/includ
e/  
	cp ~/TURTLE/executablecode/src_soclib/Makefile ~/Prog/mutekh/libavatar/


These additions are contained in Makefile.forsoclib_mpsoc which replaces
Makefile.forsoclib

cp Makefile.forsoclib_mpsoc Makefile.forsoclib

--------------------------------------------------------------------------------------
In bin/config.xml line :

<AVATARExecutableSoclibCodeCompileCommand data="make -C /home/enrici/TURTLE/exec
utablecode updategeneratedcode compilesoclib" />
has to be remplicated and modified to : 
<AVATARExecutableSoclibCodeCompileCommand data="make -C ~/TURTLE/executablecode updategeneratedcodesoclib compilesoclib" />
such that the new target updategeneratedcodesoclib, which copies the files from generated_code_soclib is taken

This line is treated in src/ui/MainGUI.java and src/ui/window/JDialogAvatarExecutableCodeGeneration
%ToDo discuss with Ludovic

---------------------------------------------------------------------------------
Summary: how to use Deployment Diagrams
=======================================

Starting from an existing diagram : open together with AVATAR diagram (File->open)

Click on AvatarDeployment (right tab) first
Click on the gear at the right of the lower toolbar (Deployment Diagram toolbar)
Select AVATAR Topcell, Tasks, and Main option (the usual case, as we do not only
want the topcell but information to be taken into account in caode and ldscript generation)

Then click on AVATAR Design (left tab)
select V&V (the Syntax Analysis reads in the diagrams and checks their syntax)
If successful, code can be generated: the gear in the upper toolbar becomes available

- select AVATAR SOCLIB code generator in the code generation menu
  it is recommended to select the debug option to have detailed output
- select Compile soclib executable in the compile menu
- select Run code in soclib/mutekh in the Exeute menu

A TTY (green on black) should open; if the debug option was selected, the
application progress and read/write operation on channels can be monitored 
(this is provisional awaiting more comfortable tracing facilities on cycle accurate level)

Designing one's own diagrams: toolbar in the Deployment Diagram tab (ower toolbar)
the following components  

CPU
task to CPU: map tasks onto processors
DMA: not yet implemented
ICU: currently transparently present in all platforms
COPROCESSOR: not yet implemented
TIMER: not yet implemented
TTY
BUS
BRIDGE: not yet implemented
VGMN
CROSSBAR : implemented but no hierarchy yet
RAM
Channel to RAM : map channels onto memory banks
ROM

"not yet implemented" = exists in AVATAR, but corresponding SoCLib component is not yet taken into account 
in the platform generation

hardware components have to be connected by arcs (fourth from the left) to the interconnect
one level of interconnect, either VGMN, bus (VGSB) or Crossbar supported currently

Right click on components then select edit allows to modify attributes : for example, specify number of cache lines,
the size of a memory bank
%Attention: some of these parameters are currently set by default an are not taken into account
%ToDo detailed doc with screenshots
--------------------------------------------------------------------------------------------
Please contact daniela.genius@lip6.fr
